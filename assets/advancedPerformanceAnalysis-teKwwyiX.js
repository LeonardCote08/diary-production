function m(){console.group("🔬 ADVANCED PERFORMANCE ANALYSIS");const e={timestamp:new Date().toISOString(),device:g(),rendering:p(),tiles:f(),hotspots:u(),memory:h(),optimizations:w(),recommendations:[]};return e.recommendations=v(e),y(e),console.groupEnd(),e}function g(){const e=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return{userAgent:navigator.userAgent,platform:navigator.platform,isMobile:e,isSafari:i,deviceMemory:navigator.deviceMemory||"unknown",hardwareConcurrency:navigator.hardwareConcurrency||"unknown",pixelRatio:window.devicePixelRatio,screenSize:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`}}function p(){const e=window.viewer;if(!e)return{error:"Viewer not found"};const i=e.drawer,t=e.viewport;return{drawerType:i!=null&&i.getType?i.getType():"unknown",pixelRatio:(i==null?void 0:i.pixelRatio)||1,canvasSize:i!=null&&i.canvas?`${i.canvas.width}x${i.canvas.height}`:"unknown",imageSmoothingEnabled:i==null?void 0:i.imageSmoothingEnabled,currentZoom:t==null?void 0:t.getZoom(),bounds:t==null?void 0:t.getBounds(),animationTime:e.animationTime,springStiffness:e.springStiffness,blendTime:e.blendTime,immediateRender:e.immediateRender,maxTilesPerFrame:e.maxTilesPerFrame}}function f(){var a,r,c;const e=window.viewer;if(!(e!=null&&e.world))return{error:"World not found"};const i=e.world.getItemAt(0);if(!i)return{error:"TiledImage not found"};const t=i._tileCache,n={fullyLoaded:i.getFullyLoaded(),tilesLoading:i._tilesLoading||0,coverage:i.getCoverage?i.getCoverage():1,cacheSize:0,cacheMaxSize:e.maxImageCacheCount,imageLoaderLimit:((a=e.imageLoader)==null?void 0:a.jobLimit)||0,activeJobs:((c=(r=e.imageLoader)==null?void 0:r.jobQueue)==null?void 0:c.length)||0};t!=null&&t._cachesLoaded&&(n.cacheSize=Object.keys(t._cachesLoaded).length);const o=[];return i._tilesToDraw&&i._tilesToDraw.forEach(d=>{const s=d.level;o[s]||(o[s]={count:0,loaded:0}),o[s].count++,d.loaded&&o[s].loaded++}),n.tileLevels=o,n}function u(){var t,n,o;const e={totalHotspots:647,visibleHotspots:0,renderedHotspots:0,animatingHotspots:0,mode:"unknown"},i=document.querySelectorAll('[data-hotspot-id]:not([style*="display: none"])');return e.visibleHotspots=i.length,i.forEach(a=>{parseFloat(window.getComputedStyle(a).opacity)>0&&e.renderedHotspots++,(a.classList.contains("animating")||a.style.animation)&&e.animatingHotspots++}),(t=window.nativeHotspotRenderer)!=null&&t.modeStateManager&&(e.mode=window.nativeHotspotRenderer.modeStateManager.getCurrentMode()),(o=(n=window.nativeHotspotRenderer)==null?void 0:n.engine)!=null&&o.lodManager&&(e.lodStats=window.nativeHotspotRenderer.engine.lodManager.getStats()),e}function h(){const e={jsHeapUsed:0,jsHeapTotal:0,jsHeapLimit:0,usagePercent:0};return performance.memory&&(e.jsHeapUsed=Math.round(performance.memory.usedJSHeapSize/1024/1024),e.jsHeapTotal=Math.round(performance.memory.totalJSHeapSize/1024/1024),e.jsHeapLimit=Math.round(performance.memory.jsHeapSizeLimit/1024/1024),e.usagePercent=(e.jsHeapUsed/e.jsHeapLimit*100).toFixed(1)),e}function w(){var i,t;const e={lowZoomOptimizer:{enabled:!1,status:{}},safariPerformanceOptimizer:{enabled:!1,state:{}},frameSkipManager:{enabled:!1,stats:{}},tileOptimizer:{enabled:!1},renderOptimizer:{enabled:!1}};return window.lowZoomOptimizer&&(e.lowZoomOptimizer.enabled=window.lowZoomOptimizer.isActive,e.lowZoomOptimizer.status=window.lowZoomOptimizer.getStatus()),window.safariPerformanceOptimizer&&(e.safariPerformanceOptimizer.enabled=!0,e.safariPerformanceOptimizer.state=window.safariPerformanceOptimizer.getState()),window.frameSkipManager&&(e.frameSkipManager.enabled=window.frameSkipManager.enabled,e.frameSkipManager.stats=window.frameSkipManager.getStats()),window.tileOptimizer&&(e.tileOptimizer.enabled=(i=window.tileOptimizer.state)==null?void 0:i.isActive),(t=window.nativeHotspotRenderer)!=null&&t.renderOptimizer&&(e.renderOptimizer.enabled=!0),e}function v(e){const i=[];return e.tiles.cacheSize<5&&e.tiles.cacheMaxSize<50&&i.push({severity:"high",category:"tiles",message:"Tile cache is underutilized. Increase maxImageCacheCount to 50-100.",impact:"+5-10 FPS"}),e.hotspots.visibleHotspots>30&&e.device.isMobile&&i.push({severity:"high",category:"hotspots",message:`Too many visible hotspots (${e.hotspots.visibleHotspots}). Reduce LOD limits to 10-15.`,impact:"+10-15 FPS"}),e.memory.usagePercent>80&&i.push({severity:"critical",category:"memory",message:"High memory usage. Reduce cache sizes and hotspot counts.",impact:"Prevent crashes"}),e.rendering.drawerType!=="canvas"&&e.device.isMobile&&i.push({severity:"critical",category:"rendering",message:"Not using Canvas drawer. Force canvas for mobile.",impact:"+15-20 FPS"}),e.rendering.blendTime>0&&e.device.isMobile&&i.push({severity:"medium",category:"rendering",message:"Tile blending enabled. Set blendTime to 0 for mobile.",impact:"+5 FPS"}),!e.optimizations.frameSkipManager.enabled&&e.device.isMobile&&i.push({severity:"medium",category:"optimization",message:"Frame skipping not enabled. Enable for smoother interactions.",impact:"+5-10 FPS"}),i}function y(e){console.log("📱 Device Info:",e.device),console.log("🎨 Rendering:",e.rendering),console.log("🏗️ Tiles:",e.tiles),console.log("🎯 Hotspots:",e.hotspots),console.log("💾 Memory:",e.memory),console.log("⚡ Active Optimizations:",e.optimizations),e.recommendations.length>0&&(console.group("💡 RECOMMENDATIONS"),e.recommendations.forEach(i=>{const t=i.severity==="critical"?"🚨":i.severity==="high"?"⚠️":"ℹ️";console.log(`${t} [${i.category}] ${i.message} (Impact: ${i.impact})`)}),console.groupEnd()),console.log(`
📊 SUMMARY:`),console.log(`- Current setup should achieve: ${l(e)} FPS`),console.log(`- Potential with optimizations: ${S(e)} FPS`)}function l(e){let i=60;return e.device.isMobile&&(i-=10),e.hotspots.visibleHotspots>30&&(i-=15),e.tiles.cacheSize<5&&(i-=10),e.rendering.blendTime>0&&(i-=5),e.memory.usagePercent>70&&(i-=10),Math.max(15,i)}function S(e){let i=l(e);return e.recommendations.forEach(t=>{var o;const n=parseInt(((o=t.impact.match(/\d+/))==null?void 0:o[0])||0);i+=n}),Math.min(60,i)}setTimeout(()=>{window.viewer&&m()},3e3);window.advancedPerfAnalysis={run:m};const z={runAdvancedAnalysis:m};export{z as default,m as runAdvancedAnalysis};
